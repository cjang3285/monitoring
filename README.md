# Monitoring Stack ë¬¸ì„œ

ëª¨ë‹ˆí„°ë§ ìŠ¤íƒì€ **ë©”íŠ¸ë¦­ ìˆ˜ì§‘ (Prometheus)**, **ë¡œê·¸ ìˆ˜ì§‘ (Loki)**, **ì‹œê°í™” (Grafana)**ë¥¼ í†µí•´ ì‹œìŠ¤í…œì„ ì¢…í•©ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

1. [ì•„í‚¤í…ì²˜](#ì•„í‚¤í…ì²˜)
2. [ì„œë¹„ìŠ¤ë³„ ì—­í• ](#ì„œë¹„ìŠ¤ë³„-ì—­í• )
3. [ì¤‘ìš”: ìˆ˜ì • í•„ìš”í•œ ì„¤ì •](#ì¤‘ìš”-ìˆ˜ì •-í•„ìš”í•œ-ì„¤ì •)
4. [í™˜ê²½ ë³€ìˆ˜ ì„¤ì •](#í™˜ê²½-ë³€ìˆ˜-ì„¤ì •)
5. [ì‹¤í–‰ ë°©ë²•](#ì‹¤í–‰-ë°©ë²•)
6. [ì ‘ì† ì •ë³´](#ì ‘ì†-ì •ë³´)
7. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)

---

## ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Grafana (í¬íŠ¸ 3000)                      â”‚
â”‚               ë©”íŠ¸ë¦­ê³¼ ë¡œê·¸ë¥¼ ì‹œê°í™”í•˜ëŠ” ëŒ€ì‹œë³´ë“œ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Prometheus (9090)      â”‚  â”‚  Loki (í¬íŠ¸ 3100)    â”‚
        â”‚ ë©”íŠ¸ë¦­ ì €ì¥ì†Œ (TSDB)      â”‚  â”‚  ë¡œê·¸ ì €ì¥ì†Œ         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Node Exporter (9100)   â”‚  â”‚ Promtail              â”‚
        â”‚  ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­ ìˆ˜ì§‘      â”‚  â”‚ ë¡œê·¸ ìˆ˜ì§‘ ì—ì´ì „íŠ¸     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                          â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œ                                 â”‚
    â”‚  - CPU, ë©”ëª¨ë¦¬, ë””ìŠ¤í¬ ì •ë³´ (/proc, /sys)               â”‚
    â”‚  - PM2 ë¸”ë¡œê·¸ ë¡œê·¸                                        â”‚
    â”‚  - Python ì‹¤í–‰ ë¡œê·¸ (LearningCollector)                  â”‚
    â”‚  - Docker ì»¨í…Œì´ë„ˆ ë¡œê·¸                                   â”‚
    â”‚  - ì‹œìŠ¤í…œ ë¡œê·¸                                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°ì´í„° íë¦„

```
ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­                          ë¡œê·¸ ë°ì´í„°
    â”‚                                   â”‚
    â–¼                                   â–¼
Node Exporter                        Promtail
    â”‚                                   â”‚
    â–¼                                   â–¼
Prometheus TSDB                      Loki ì €ì¥ì†Œ
    â”‚                                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
                    Grafana
              (ëŒ€ì‹œë³´ë“œì—ì„œ ì¡°íšŒ)
```

---

## ì„œë¹„ìŠ¤ë³„ ì—­í• 

### 1. Prometheus (ë©”íŠ¸ë¦­ ìˆ˜ì§‘)

**ì—­í• :** ì‹œìŠ¤í…œì˜ ìˆ«ì ë°ì´í„°(ë©”íŠ¸ë¦­)ë¥¼ ìˆ˜ì§‘, ì €ì¥, ì¿¼ë¦¬

**ìˆ˜ì§‘í•˜ëŠ” ë©”íŠ¸ë¦­:**
- CPU ì‚¬ìš©ë¥ 
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
- ë””ìŠ¤í¬ I/O
- ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½
- ì• í”Œë¦¬ì¼€ì´ì…˜ ì‘ë‹µ ì‹œê°„

**ìˆ˜ì§‘ ê°„ê²©:** 15ì´ˆë§ˆë‹¤ (ê¸°ë³¸ê°’)

**ì €ì¥ ë°©ì‹:** ì‹œê³„ì—´ ë°ì´í„°ë² ì´ìŠ¤ (TSDB)
```
ë©”íŠ¸ë¦­ëª…{ë¼ë²¨ë“¤} = ê°’ (íƒ€ì„ìŠ¤íƒí”„)

ì˜ˆì‹œ:
cpu_usage{job="blog",instance="localhost:8080"} 45.5 (2024-02-05T10:30:00Z)
```

---

### 2. Node Exporter (ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­ ìˆ˜ì¶œ)

**ì—­í• :** í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œì˜ ì •ë³´ë¥¼ ìˆ˜ì§‘í•´ì„œ Prometheusê°€ ì½ì„ ìˆ˜ ìˆëŠ” í˜•ì‹ìœ¼ë¡œ ë³€í™˜

**ë™ì‘ ì›ë¦¬:**
```
í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œ ì •ë³´
  (/proc, /sys íŒŒì¼ì‹œìŠ¤í…œ)
    â”‚
    â–¼
Node Exporterê°€ ì½ìŒ
    â”‚
    â–¼
í…ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
    â”‚
    â–¼
http://localhost:9100/metrics (Prometheusê°€ ì£¼ê¸°ì ìœ¼ë¡œ ì´ URL ì ‘ê·¼)
```

**ìˆ˜ì§‘ ë°©ì‹:**
- `/proc/cpuinfo`: CPU ì •ë³´
- `/proc/meminfo`: ë©”ëª¨ë¦¬ ì •ë³´
- `/sys/devices/...`: í•˜ë“œì›¨ì–´ ì •ë³´
- ê¸°íƒ€ ì‹œìŠ¤í…œ ì •ë³´

**ì»¨í…Œì´ë„ˆ ì„¤ì • ì´ìœ :**
```yaml
volumes:
  - /proc:/host/proc:ro      # í˜¸ìŠ¤íŠ¸ì˜ /procë¥¼ ì½ê¸°ì „ìš©ìœ¼ë¡œ ë§ˆìš´íŠ¸
  - /sys:/host/sys:ro        # í˜¸ìŠ¤íŠ¸ì˜ /sysë¥¼ ì½ê¸°ì „ìš©ìœ¼ë¡œ ë§ˆìš´íŠ¸
  - /:/rootfs:ro             # í˜¸ìŠ¤íŠ¸ ì „ì²´ íŒŒì¼ì‹œìŠ¤í…œì„ ì½ê¸°ì „ìš©ìœ¼ë¡œ ë§ˆìš´íŠ¸
```
ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ í˜¸ìŠ¤íŠ¸ ì •ë³´ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ í•„ìš”í•©ë‹ˆë‹¤.

---

### 3. Loki (ë¡œê·¸ ì €ì¥ì†Œ)

**ì—­í• :** ëŒ€ëŸ‰ì˜ ë¡œê·¸ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì €ì¥í•˜ê³  ê²€ìƒ‰

**íŠ¹ì§•:**
- ì¸ë±ì‹±: ë¹ ë¥¸ ê²€ìƒ‰ (í•˜ë£¨ë§ˆë‹¤ ìƒˆ ì¸ë±ìŠ¤ ìƒì„±)
- ì••ì¶•: snappy ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ì €ì¥ ê³µê°„ ì ˆì•½
- ë ˆì´ë¸” ê¸°ë°˜ ê²€ìƒ‰: ë¡œê·¸ì— ë¶™ì€ ë¼ë²¨ë¡œ í•„í„°ë§

**ì €ì¥ ë°©ì‹:**
```
loki-data/
â”œâ”€â”€ boltdb-shipper-active/
â”‚   â””â”€â”€ index_2024-02-05.db  # ì˜¤ëŠ˜ ì¸ë±ìŠ¤
â”œâ”€â”€ chunks/
â”‚   â”œâ”€â”€ 2024-02-05/          # ì˜¤ëŠ˜ ë¡œê·¸ ë°ì´í„°
â”‚   â”œâ”€â”€ 2024-02-04/          # ì–´ì œ ë¡œê·¸ ë°ì´í„°
â”‚   â””â”€â”€ ...
```

**ì¸ë±ìŠ¤ë€?**
- ì±…ì˜ ëª©ì°¨ì²˜ëŸ¼ ë¡œê·¸ì˜ ìœ„ì¹˜ë¥¼ ë¹ ë¥´ê²Œ ì°¾ì•„ì£¼ëŠ” ë„êµ¬
- ë‚ ì§œë³„ë¡œ ì¸ë±ìŠ¤ë¥¼ ë‚˜ëˆ„ì–´ì„œ ê²€ìƒ‰ ì†ë„ í–¥ìƒ
- ì˜ˆ: "Error" ê²€ìƒ‰ â†’ ì¸ë±ìŠ¤ì—ì„œ ìœ„ì¹˜ í™•ì¸ â†’ í•´ë‹¹ ë¶€ë¶„ë§Œ ì½ìŒ (ë¹ ë¦„)

**ë¼ë²¨ ê¸°ë°˜ ê²€ìƒ‰:**
```
ê²€ìƒ‰: {job="blog_pm2", level="ERROR"}

ê²°ê³¼:
[2024-02-05T10:30:00Z] ERROR: Database connection failed
[2024-02-05T10:31:05Z] ERROR: Retry attempt 1
```

---

### 4. Promtail (ë¡œê·¸ ìˆ˜ì§‘ ì—ì´ì „íŠ¸)

**ì—­í• :** í˜¸ìŠ¤íŠ¸ì™€ Docker ì»¨í…Œì´ë„ˆì˜ ë¡œê·¸ë¥¼ ì°¾ì•„ì„œ Lokië¡œ ì „ì†¡

**ìˆ˜ì§‘ ë°©ì‹:**

| ë¡œê·¸ ì¢…ë¥˜ | ê²½ë¡œ | ì„¤ëª… |
|---------|------|------|
| PM2 ë¸”ë¡œê·¸ | `/var/log/pm2/blog/*.log` | ë¸”ë¡œê·¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ |
| Python ì‹¤í–‰ ë¡œê·¸ | `/var/log/python/*.log` | LearningCollector ì‹¤í–‰ ë¡œê·¸ |
| Docker ë¡œê·¸ | Docker ì†Œì¼“ | ì‹¤í–‰ ì¤‘ì¸ ëª¨ë“  ì»¨í…Œì´ë„ˆ ë¡œê·¸ |
| ì‹œìŠ¤í…œ ë¡œê·¸ | `/var/log/syslog` | ì‹œìŠ¤í…œ ì „ì²´ ë¡œê·¸ |

**ë™ì‘ ì›ë¦¬:**
```
1. ì„¤ì •ëœ ê²½ë¡œ/Docker ì†Œì¼“ ê°ì‹œ
2. ìƒˆ ë¡œê·¸ ë°œê²¬ ë˜ëŠ” ë³€ê²½ ê°ì§€
3. ë³€ê²½ëœ ë¶€ë¶„ë§Œ ì½ìŒ (/tmp/positions.yamlì—ì„œ ë§ˆì§€ë§‰ ìœ„ì¹˜ ê¸°ì–µ)
4. Lokië¡œ ì „ì†¡
```

**positions íŒŒì¼:**
- íŒŒì¼: `/tmp/positions.yaml` (ì»¨í…Œì´ë„ˆ ë‚´ë¶€)
- ìš©ë„: ê° ë¡œê·¸ íŒŒì¼ì˜ ë§ˆì§€ë§‰ ì½ì€ ìœ„ì¹˜ ê¸°ë¡
- ì´ìœ : ì¬ì‹œì‘ í›„ì—ë„ ì¤‘ë³µ ì—†ì´ ì´ì–´ì„œ ì½ê¸°

**Docker ì†Œì¼“ì´ í•„ìš”í•œ ì´ìœ :**
```
/var/run/docker.sockì€ Docker ë°ëª¬ê³¼ í†µì‹ í•˜ëŠ” íŒŒì´í”„

Promtailì´ ì´ê²ƒì— ì ‘ê·¼í•˜ë©´:
1. í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ëª¨ë“  ì»¨í…Œì´ë„ˆ ëª©ë¡ ì¡°íšŒ
2. ìƒˆ ì»¨í…Œì´ë„ˆ ê°ì§€ â†’ ìë™ìœ¼ë¡œ ë¡œê·¸ ìˆ˜ì§‘ ì‹œì‘
3. ì¢…ë£Œëœ ì»¨í…Œì´ë„ˆ ê°ì§€ â†’ ë¡œê·¸ ìˆ˜ì§‘ ì¤‘ì§€
```

---

### 5. Grafana (ì‹œê°í™” ë° ëŒ€ì‹œë³´ë“œ)

**ì—­í• :** Prometheusì™€ Lokiì—ì„œ ë°ì´í„°ë¥¼ ì¡°íšŒí•´ì„œ ëŒ€ì‹œë³´ë“œì— ì‹œê°í™”

**ê¸°ëŠ¥:**
- ë©”íŠ¸ë¦­ ì‹œê°í™” (ê·¸ë˜í”„, ê²Œì´ì§€ ë“±)
- ë¡œê·¸ ê²€ìƒ‰ ë° í‘œì‹œ
- ì•ŒëŒ ì„¤ì • (ì¶”í›„)
- ëŒ€ì‹œë³´ë“œ ê³µìœ 

**ì ‘ì†:** http://localhost:3001
- ê¸°ë³¸ ì•„ì´ë””: admin
- ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸: `.env` íŒŒì¼ì—ì„œ ì„¤ì • (ë‹¤ìŒ ì„¹ì…˜ ì°¸ê³ )

---

## ì¤‘ìš”: ìˆ˜ì • í•„ìš”í•œ ì„¤ì •

### âš ï¸ 1. PM2 ë¸”ë¡œê·¸ ë¡œê·¸ ê²½ë¡œ

**íŒŒì¼:** `config/promtail/config.yml`

**í˜„ì¬ ì„¤ì •:**
```yaml
- job_name: blog_pm2_logs
  static_configs:
    - targets:
        - localhost
      labels:
        job: blog_pm2
        __path__: /var/log/pm2/blog/*.log  # â† ì´ ê²½ë¡œ í™•ì¸ í•„ìš”!
```

**ìˆ˜ì • ë°©ë²•:**
```bash
# 1. ì‹¤ì œ PM2 ë¸”ë¡œê·¸ ë¡œê·¸ ê²½ë¡œ í™•ì¸
pm2 logs --lines 1
# ì¶œë ¥: /home/user/.pm2/logs/blog-out.log ê°™ì€ ê²½ë¡œ ë‚˜ì˜´

# 2. config.yml ìˆ˜ì •
# __path__: /var/log/pm2/blog/*.log
# ë‹¤ìŒê³¼ ê°™ì´ ë³€ê²½:
# __path__: /home/user/.pm2/logs/blog-*.log
```

**ì›ë³¸ ê²½ë¡œê°€ ë¶ˆí™•ì‹¤í•˜ë©´:**
```bash
# PM2 ëª¨ë‹ˆí„°ë§ í´ë” í™•ì¸
pm2 describe blog

# ë˜ëŠ”
ls -la ~/.pm2/logs/
```

---

### âš ï¸ 2. Python LearningCollector ë¡œê·¸ ê²½ë¡œ

**íŒŒì¼:** `config/promtail/config.yml`

**í˜„ì¬ ì„¤ì •:**
```yaml
- job_name: python_logs
  static_configs:
    - targets:
        - localhost
      labels:
        job: python_code
        __path__: /var/log/python/*.log  # â† ì´ ê²½ë¡œ í™•ì¸ í•„ìš”!
```

**ìˆ˜ì • ë°©ë²•:**

LearningCollectorì˜ ì‹¤ì œ ë¡œê·¸ ì¶œë ¥ ê²½ë¡œì— ë§ê²Œ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.

```bash
# ì˜ˆì‹œ ê²½ë¡œë“¤ (í”„ë¡œì íŠ¸ êµ¬ì¡°ì— ë”°ë¼ ë‹¤ë¦„):
# /home/user/learning-collector/logs/*.log
# /var/log/learning-collector/*.log
# /opt/learning-collector/logs/*.log
```

**í™•ì¸ ë°©ë²•:**
```bash
# 1. LearningCollector ì„¤ì • íŒŒì¼ í™•ì¸
cat /path/to/learning-collector/config.py
# ë˜ëŠ”
grep -r "LOG" /path/to/learning-collector/

# 2. ì‹¤ì œ ë¡œê·¸ ìƒì„± ìœ„ì¹˜ í™•ì¸
find /home/user -name "*.log" -path "*learning*" -o -path "*python*"
```

**ì •í™•í•œ ê²½ë¡œë¥¼ ì•Œì•„ë‚¸ í›„:**
```yaml
__path__: /ì‹¤ì œ/ê²½ë¡œ/*.log  # ì´ë ‡ê²Œ ìˆ˜ì •
```

---

## í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

### Grafana ë¹„ë°€ë²ˆí˜¸ ë³´ì•ˆ ê´€ë¦¬

**ë¬¸ì œ:** docker-compose.ymlì— ë¹„ë°€ë²ˆí˜¸ë¥¼ ì§ì ‘ ì‘ì„±í•˜ë©´ Gitì— ì˜¬ë ¸ì„ ë•Œ ë³´ì•ˆ ìœ„í—˜

**í•´ê²°:** í™˜ê²½ ë³€ìˆ˜ë¡œ ë¶„ë¦¬

### Step 1: .env íŒŒì¼ ìƒì„±

```bash
# í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— .env íŒŒì¼ ìƒì„±
cat > .env << 'EOF'
# Grafana ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ (ë³µì¡í•œ ë¹„ë°€ë²ˆí˜¸ ê¶Œì¥)
GRAFANA_ADMIN_PASSWORD=your-secure-password-here

# ì¶”ê°€ í•„ìš”í•œ í™˜ê²½ ë³€ìˆ˜
# DATABASE_PASSWORD=...
# API_KEY=...
EOF
```

**ë¹„ë°€ë²ˆí˜¸ ìƒì„± íŒ:**
```bash
# ê°•ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ ìë™ ìƒì„±
openssl rand -base64 12

# ì˜ˆì‹œ ê²°ê³¼: aB3cDeFg5hIjK=
```

### Step 2: docker-compose.yml ìˆ˜ì •

**í˜„ì¬:**
```yaml
grafana:
  environment:
    - GF_SECURITY_ADMIN_PASSWORD=admin
```

**ë³€ê²½:**
```yaml
grafana:
  environment:
    - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_ADMIN_PASSWORD}
```

### Step 3: .gitignoreì— ì¶”ê°€

```bash
# í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ .gitignore íŒŒì¼ì— ì¶”ê°€
echo ".env" >> .gitignore
```

í™•ì¸:
```bash
cat .gitignore
# ì¶œë ¥ì— .env í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
```

### Step 4: íŒ€ì›ê³¼ ê³µìœ í•˜ë ¤ë©´

```bash
# .env.example íŒŒì¼ ìƒì„± (êµ¬ì¡°ë§Œ í¬í•¨, ì‹¤ì œ ê°’ì€ ì—†ìŒ)
cat > .env.example << 'EOF'
# Grafana ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸
GRAFANA_ADMIN_PASSWORD=change_me

# ì¶”ê°€ í•„ìš”í•œ í™˜ê²½ ë³€ìˆ˜
# DATABASE_PASSWORD=change_me
# API_KEY=change_me
EOF

# Gitì— ì»¤ë°‹ (ì‹¤ì œ ë¹„ë°€ë²ˆí˜¸ëŠ” ì—†ìœ¼ë¯€ë¡œ ì•ˆì „)
git add .env.example
git commit -m "Add .env.example template"
```

### Step 5: ì‹¤í–‰

```bash
# ë°©ë²• 1: .env ìë™ ë¡œë“œ (docker-composeê°€ ìë™ìœ¼ë¡œ .env ì½ìŒ)
docker-compose up

# ë°©ë²• 2: ëª…ì‹œì ìœ¼ë¡œ .env ì§€ì •
docker-compose --env-file .env up

# ë°©ë²• 3: ëª…ë ¹ì¤„ë¡œ ì „ë‹¬
GRAFANA_ADMIN_PASSWORD=mypassword docker-compose up
```

---

## ì‹¤í–‰ ë°©ë²•

### í•„ìˆ˜ ì‚¬ì „ ì¤€ë¹„

```bash
# 1. ë¡œê·¸ ë””ë ‰í† ë¦¬ ìƒì„± (í•„ìš”ì‹œ)
mkdir -p /var/log/pm2/blog
mkdir -p /var/log/python
chmod 755 /var/log/pm2/blog
chmod 755 /var/log/python

# 2. Docker ë° Docker Compose ì„¤ì¹˜ í™•ì¸
docker --version
docker-compose --version

# 3. .env íŒŒì¼ ìƒì„±
cp .env.example .env
# .env íŒŒì¼ì„ í…ìŠ¤íŠ¸ ì—ë””í„°ë¡œ ì—´ì–´ì„œ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
```

### ì‹¤í–‰

```bash
# 1. ì²« ì‹¤í–‰ (ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ë° ì»¨í…Œì´ë„ˆ ìƒì„±)
docker-compose up -d

# 2. ë¡œê·¸ í™•ì¸
docker-compose logs -f

# 3. ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
docker-compose ps

# 4. íŠ¹ì • ì„œë¹„ìŠ¤ ë¡œê·¸ë§Œ ë³´ê¸°
docker-compose logs -f prometheus
docker-compose logs -f promtail
docker-compose logs -f grafana
```

### ì¤‘ì§€

```bash
# 1. ì„œë¹„ìŠ¤ ì¤‘ì§€ (ë°ì´í„°ëŠ” ìœ ì§€)
docker-compose stop

# 2. ì„œë¹„ìŠ¤ ì¬ì‹œì‘
docker-compose restart

# 3. ì„œë¹„ìŠ¤ ì‚­ì œ (ë°ì´í„°ëŠ” ìœ ì§€)
docker-compose down

# 4. ëª¨ë“  ë°ì´í„° í¬í•¨ ì‚­ì œ
docker-compose down -v
```

---

## ì ‘ì† ì •ë³´

### Grafana (ëŒ€ì‹œë³´ë“œ)

```
URL: http://localhost:3001
ì•„ì´ë””: admin
ë¹„ë°€ë²ˆí˜¸: .env íŒŒì¼ì˜ GRAFANA_ADMIN_PASSWORD
```

**ì²˜ìŒ ë¡œê·¸ì¸ í›„ í•  ì¼:**
```
1. ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (ì¢Œì¸¡ ë©”ë‰´ â†’ Profile)
2. ë°ì´í„°ì†ŒìŠ¤ í™•ì¸ (Configuration â†’ Data Sources)
   - Prometheus: http://prometheus:9090 (ì •ìƒì´ì–´ì•¼ í•¨)
   - Loki: http://loki:3100 (ì •ìƒì´ì–´ì•¼ í•¨)
3. ìƒ˜í”Œ ëŒ€ì‹œë³´ë“œ ìƒì„± (Dashboards â†’ New Dashboard)
```

### Prometheus (ë©”íŠ¸ë¦­ ì €ì¥ì†Œ)

```
URL: http://localhost:9090
ì£¼ìš©ë„: ë©”íŠ¸ë¦­ ì¿¼ë¦¬ ë° ëª¨ë‹ˆí„°ë§
```

**í™•ì¸í•  ì‚¬í•­:**
```
1. Targets í˜ì´ì§€ (Status â†’ Targets)
   - prometheus: UPì´ì–´ì•¼ í•¨
   - node-exporter: UPì´ì–´ì•¼ í•¨
   - blog (ì„¤ì •í•œ ê²½ìš°): UPì´ì–´ì•¼ í•¨

2. Graph í˜ì´ì§€ì—ì„œ ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
   ì˜ˆ: up (ëª¨ë“  ì—…ìŠ¤íŠ¸ë¦¼ ìƒíƒœ)
```

### Loki (ë¡œê·¸ ì €ì¥ì†Œ)

```
URL: http://localhost:3100
ì£¼ìš©ë„: ë¡œê·¸ ì €ì¥ì†Œ (Grafanaë¥¼ í†µí•´ ì ‘ê·¼ ê¶Œì¥)
```

### Node Exporter

```
URL: http://localhost:9100/metrics
ì£¼ìš©ë„: ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­ í™•ì¸ (ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì¡°íšŒ ê°€ëŠ¥)
```

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. Prometheusê°€ Node Exporterë¥¼ ì°¾ì§€ ëª»í•¨

**ì¦ìƒ:**
```
Status â†’ Targetsì—ì„œ node-exporterê°€ DOWN
```

**í•´ê²°:**
```bash
# 1. ë„¤íŠ¸ì›Œí¬ í™•ì¸
docker-compose ps

# 2. Node Exporter ë¡œê·¸ í™•ì¸
docker-compose logs node-exporter

# 3. ìˆ˜ë™ í…ŒìŠ¤íŠ¸
docker-compose exec prometheus curl http://node-exporter:9100/metrics

# ì¼ë°˜ì ì¸ ì›ì¸ ë° í•´ê²°:
# - ì»¨í…Œì´ë„ˆ ë¯¸ì‹¤í–‰: docker-compose restart node-exporter
# - í¬íŠ¸ ì¶©ëŒ: docker psë¡œ í¬íŠ¸ í™•ì¸, ê¸°ì¡´ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
# - ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ: docker network inspect monitoring í™•ì¸
```

### 2. Promtailì´ ë¡œê·¸ë¥¼ ìˆ˜ì§‘í•˜ì§€ ëª»í•¨

**ì¦ìƒ:**
```
Grafana â†’ Explore â†’ Lokiì—ì„œ ë¡œê·¸ê°€ ë³´ì´ì§€ ì•ŠìŒ
```

**í•´ê²°:**
```bash
# 1. Promtail ë¡œê·¸ í™•ì¸
docker-compose logs promtail

# 2. ì„¤ì •ëœ ê²½ë¡œì— ë¡œê·¸ íŒŒì¼ ì¡´ì¬ í™•ì¸
docker-compose exec promtail ls -la /var/log/pm2/blog/
docker-compose exec promtail ls -la /var/log/python/

# 3. ê²½ë¡œ ìˆ˜ì • í•„ìš”í•œ ê²½ìš°:
# - config/promtail/config.yml ìˆ˜ì •
# - docker-compose restart promtail

# 4. ê¶Œí•œ í™•ì¸
ls -la /var/log/pm2/blog/
# ì½ê¸° ê¶Œí•œ(r)ì´ ìˆëŠ”ì§€ í™•ì¸
```

### 3. Docker ì†Œì¼“ ê¶Œí•œ ì˜¤ë¥˜

**ì¦ìƒ:**
```
Promtail ë¡œê·¸ì— "permission denied" ë©”ì‹œì§€
```

**í•´ê²°:**
```bash
# 1. í˜„ì¬ ê¶Œí•œ í™•ì¸
ls -la /var/run/docker.sock

# 2. ê¶Œí•œ ë³€ê²½ (ì¼ì‹œì )
sudo chmod 666 /var/run/docker.sock

# 3. ì˜êµ¬ì  í•´ê²° (ê¶Œì¥)
# docker ê·¸ë£¹ì— ì‚¬ìš©ì ì¶”ê°€
sudo usermod -aG docker $USER

# 4. ë¡œê·¸ì¸ ë‹¤ì‹œ (ê·¸ë£¹ ë³€ê²½ ì ìš©)
# ë˜ëŠ”
newgrp docker
```

### 4. ë””ìŠ¤í¬ ê³µê°„ ë¶€ì¡±

**ì¦ìƒ:**
```
"Disk quota exceeded" ì˜¤ë¥˜
```

**í•´ê²°:**
```bash
# 1. ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ í™•ì¸
df -h

# 2. íŠ¹ì • ì„œë¹„ìŠ¤ ë°ì´í„° ì •ë¦¬
# Prometheus (ì˜¤ë˜ëœ ë©”íŠ¸ë¦­ ì‚­ì œ)
docker-compose exec prometheus rm -rf /prometheus/*

# Loki (ì˜¤ë˜ëœ ë¡œê·¸ ì‚­ì œ)
docker-compose exec loki rm -rf /loki/chunks/2024-01-*

# 3. ë˜ëŠ” ì „ì²´ ì´ˆê¸°í™”
docker-compose down -v
docker system prune -a
```

### 5. Grafana ì ‘ì† ë¶ˆê°€

**ì¦ìƒ:**
```
http://localhost:3001 ì ‘ê·¼ ë¶ˆê°€
```

**í•´ê²°:**
```bash
# 1. Grafana ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
docker-compose ps grafana

# 2. Grafana ë¡œê·¸ í™•ì¸
docker-compose logs grafana

# 3. í¬íŠ¸ ì¶©ëŒ í™•ì¸
netstat -tuln | grep 3001

# 4. Grafana ì¬ì‹œì‘
docker-compose restart grafana

# 5. í¬íŠ¸ê°€ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ê²½ìš°
# docker-compose.ymlì—ì„œ í¬íŠ¸ ë³€ê²½
# ports: - "3002:3000"
```

### 6. ë©”ëª¨ë¦¬ ë¶€ì¡±

**ì¦ìƒ:**
```
ì»¨í…Œì´ë„ˆê°€ ìì£¼ ì¬ì‹œì‘ë¨
```

**í•´ê²°:**
```bash
# 1. í˜„ì¬ ì‚¬ìš©ëŸ‰ í™•ì¸
docker stats

# 2. docker-compose.ymlì— ë©”ëª¨ë¦¬ ì œí•œ ì¶”ê°€
services:
  prometheus:
    mem_limit: 2g      # 2GB ì œí•œ
  grafana:
    mem_limit: 1g      # 1GB ì œí•œ
  loki:
    mem_limit: 2g      # 2GB ì œí•œ

# 3. ë³€ê²½ í›„ ì¬ì‹œì‘
docker-compose down
docker-compose up -d
```

---

## ë‹¤ìŒ ë‹¨ê³„

### 1ë‹¨ê³„: ê¸°ë³¸ ëª¨ë‹ˆí„°ë§ ì•ˆì •í™” (í˜„ì¬)
- [ ] Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í™•ì¸
- [ ] Loki ë¡œê·¸ ìˆ˜ì§‘ í™•ì¸
- [ ] Grafana ëŒ€ì‹œë³´ë“œ ìƒì„±

### 2ë‹¨ê³„: ê²½ê³  ê·œì¹™ ì¶”ê°€ (1-2ì£¼ í›„)
- [ ] CPU > 80% ê²½ê³ 
- [ ] ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  > 85% ê²½ê³ 
- [ ] ë””ìŠ¤í¬ ì‚¬ìš©ë¥  > 90% ê²½ê³ 
- [ ] ì„œë¹„ìŠ¤ ë‹¤ìš´ ê°ì§€

### 3ë‹¨ê³„: Alert Manager ì—°ë™ (1ê°œì›” í›„)
- [ ] Email ì•Œë¦¼
- [ ] Slack ì—°ë™
- [ ] PagerDuty ì—°ë™
- [ ] ì˜¨ì½œ(on-call) ê´€ë¦¬

### 4ë‹¨ê³„: ì»¤ìŠ¤í…€ ëŒ€ì‹œë³´ë“œ ìƒì„±
- [ ] ë¸”ë¡œê·¸ ì„±ëŠ¥ ëŒ€ì‹œë³´ë“œ
- [ ] Python ì‹¤í–‰ ë¡œê·¸ ë¶„ì„ ëŒ€ì‹œë³´ë“œ
- [ ] ì‹œìŠ¤í…œ ìƒíƒœ ìš”ì•½ ëŒ€ì‹œë³´ë“œ

---

## ì°¸ê³  ìë£Œ

### ê³µì‹ ë¬¸ì„œ
- [Prometheus Documentation](https://prometheus.io/docs/)
- [Grafana Documentation](https://grafana.com/docs/grafana/)
- [Loki Documentation](https://grafana.com/docs/loki/)

### ìœ ìš©í•œ ì¿¼ë¦¬

**Prometheus:**
```promql
# CPU ì‚¬ìš©ë¥ 
100 - (avg by (instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)

# ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ 
(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100

# ë””ìŠ¤í¬ ì‚¬ìš©ë¥ 
100 * (1 - (node_filesystem_avail_bytes / node_filesystem_size_bytes))
```

**Loki:**
```logql
# ì—ëŸ¬ ë¡œê·¸ ì¡°íšŒ
{job="blog_pm2"} |= "error"

# íŠ¹ì • ì‹œê°„ëŒ€ ë¡œê·¸
{job="python_code"} | after(5m)

# ë¡œê·¸ ë¼ì¸ ìˆ˜ ê³„ì‚°
sum(count_over_time({job="blog_pm2"}[5m]))
```

---

## ë¼ì´ì„ ìŠ¤

ì´ ëª¨ë‹ˆí„°ë§ ìŠ¤íƒì€ ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ë“¤ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

- Prometheus: Apache License 2.0
- Grafana: AGPL v3.0
- Loki: AGPL v3.0

---

ìµœì¢… ì—…ë°ì´íŠ¸: 2024-02-05
